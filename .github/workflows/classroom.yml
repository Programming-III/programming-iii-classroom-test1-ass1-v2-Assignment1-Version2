name: Autograding Tests
'on':
  repository_dispatch: []
  schedule:
  - cron: '47 19 * * *'
permissions:
  checks: write
  actions: read
  contents: read
jobs:
  run-autograding-tests:
    runs-on: ubuntu-latest
    if: github.actor != 'github-classroom[bot]'
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    - name: Implementation File Check
      id: implementation-file-check
      uses: classroom-resources/autograding-command-grader@v1
      with:
        test-name: Implementation File Check
        setup-command: g++ -std=c++11 -o main main.cpp
        command: find . -maxdepth 1 -name '*.cpp' | wc -l
        timeout: 10
        max-score: 2
    - name: Private Members Check
      id: private-members-check
      uses: classroom-resources/autograding-command-grader@v1
      with:
        test-name: Private Members Check
        setup-command: g++ -std=c++11 -o main main.cpp
        command: found=0; for class in Person Student Instructor Course; do [ -f "${class}.h"
          ] || continue; private_section=$(sed -n '/private:/,/public:\|protected:\|^}/p'
          "${class}.h"); attr_count=$(echo "$private_section" | grep -E '^\s+\w+.*\w+\s*;'
          | grep -v '(' | wc -l); [ "$attr_count" -ge 1 ] && found=$((found+1)); done;
          case $found in 0) echo "0.00" ;; 1) echo "1.25" ;; 2) echo "2.50" ;; 3)
          echo "3.75" ;; 4) echo "5.00" ;; esac
        timeout: 10
        max-score: 5
    - name: All Classes Declared
      id: all-classes-declared
      uses: classroom-resources/autograding-command-grader@v1
      with:
        test-name: All Classes Declared
        setup-command: g++ -std=c++11 -o main main.cpp
        command: 'grep -c ''^class '' *.h | awk -F: ''{sum += $2} END {print sum}'''
        timeout: 10
        max-score: 5
    - name: Constructor Declaration
      id: constructor-declaration
      uses: classroom-resources/autograding-command-grader@v1
      with:
        test-name: Constructor Declaration
        setup-command: g++ -std=c++11 -o main main.cpp
        command: found=0; for class in Person Student Instructor Course; do [ -f "${class}.h"
          ] && grep -qE "^\s*${class}\s*\(" "${class}.h" && found=$((found+1)); done;
          case $found in 0) echo "0.00" ;; 1) echo "1.25" ;; 2) echo "2.50" ;; 3)
          echo "3.75" ;; 4) echo "5.00" ;; esac
        timeout: 10
        max-score: 5
    - name: Destructor Declaration
      id: destructor-declaration
      uses: classroom-resources/autograding-command-grader@v1
      with:
        test-name: Destructor Declaration
        setup-command: g++ -std=c++11 -o main main.cpp
        command: found=0; for class in Person Student Instructor Course; do [ -f "${class}.h"
          ] && grep -q "~${class}" "${class}.h" && found=$((found+1)); done; case
          $found in 0) echo "0.00" ;; 1) echo "1.25" ;; 2) echo "2.50" ;; 3) echo
          "3.75" ;; 4) echo "5.00" ;; esac
        timeout: 10
        max-score: 5
    - name: Course Display
      id: course-display
      uses: classroom-resources/autograding-command-grader@v1
      with:
        test-name: Course Display
        setup-command: g++ -std=c++11 -o main main.cpp
        command: ./main | grep -q "CS101"
        timeout: 10
        max-score: 5
    - name: Instructor Display
      id: instructor-display
      uses: classroom-resources/autograding-command-grader@v1
      with:
        test-name: Instructor Display
        setup-command: g++ -std=c++11 -o main main.cpp
        command: ./main | grep -q "Dr. Lina Khaled"
        timeout: 10
        max-score: 5
    - name: Student Display
      id: student-display
      uses: classroom-resources/autograding-command-grader@v1
      with:
        test-name: Student Display
        setup-command: g++ -std=c++11 -o main main.cpp
        command: './main | grep -q "Omar Nabil" && ./main | grep -q "2202" && ./main
          | grep -q "Year: 2" && ./main | grep -q "Major: Informatics"'
        timeout: 10
        max-score: 5
    - name: Student Inherit Person
      id: student-inherit-person
      uses: classroom-resources/autograding-command-grader@v1
      with:
        test-name: Student Inherit Person
        setup-command: g++ -std=c++11 -o main main.cpp
        command: grep -qE "class\s+Student\s*:\s*(public|protected|private)\s+Person"
          "Student.h" && echo "5.00" || echo "0.00"
        timeout: 10
        max-score: 5
    - name: Instructor Inherit Person
      id: instructor-inherit-person
      uses: classroom-resources/autograding-command-grader@v1
      with:
        test-name: Instructor Inherit Person
        setup-command: g++ -std=c++11 -o main main.cpp
        command: grep -qE "class\s+Instructor\s*:\s*(public|protected|private)\s+Person"
          "Instructor.h" && echo "5.00" || echo "0.00"
        timeout: 10
        max-score: 5
    - name: Autograding Reporter
      uses: classroom-resources/autograding-grading-reporter@v1
      env:
        IMPLEMENTATION-FILE-CHECK_RESULTS: "${{steps.implementation-file-check.outputs.result}}"
        PRIVATE-MEMBERS-CHECK_RESULTS: "${{steps.private-members-check.outputs.result}}"
        ALL-CLASSES-DECLARED_RESULTS: "${{steps.all-classes-declared.outputs.result}}"
        CONSTRUCTOR-DECLARATION_RESULTS: "${{steps.constructor-declaration.outputs.result}}"
        DESTRUCTOR-DECLARATION_RESULTS: "${{steps.destructor-declaration.outputs.result}}"
        COURSE-DISPLAY_RESULTS: "${{steps.course-display.outputs.result}}"
        INSTRUCTOR-DISPLAY_RESULTS: "${{steps.instructor-display.outputs.result}}"
        STUDENT-DISPLAY_RESULTS: "${{steps.student-display.outputs.result}}"
        STUDENT-INHERIT-PERSON_RESULTS: "${{steps.student-inherit-person.outputs.result}}"
        INSTRUCTOR-INHERIT-PERSON_RESULTS: "${{steps.instructor-inherit-person.outputs.result}}"
      with:
        runners: implementation-file-check,private-members-check,all-classes-declared,constructor-declaration,destructor-declaration,course-display,instructor-display,student-display,student-inherit-person,instructor-inherit-person
